# cognito-multi-user-multi-webpage

This demo showcases how to set up a multi-user, multi-webpage authorization mechanism leveraging on Amazon Cognito.

# 认证与图片访问流程

┌──────────┐      ┌─────────────────┐      ┌─────────────────────┐      ┌──────────────┐
│  用户     │      │  localhost:3000 │      │  Cognito (<>)       │      │  S3 Bucket   │
│ (浏览器)  │      │  (Node Server)  │      │  <>-auth.auth...    │      │              │
└────┬─────┘      └────────┬────────┘      └──────────┬──────────┘      └──────┬───────┘
     │                     │                         │                        │
     │  1. 访问 /           │                         │                        │
     │ ─────────────────►  │                         │                        │
     │                     │                         │                        │
     │  2. 302 重定向       │                         │                        │
     │ ◄─────────────────  │                         │                        │
     │                     │                         │                        │
     │  3. 跳转到 Cognito 登录页                       │                        │
     │ ──────────────────────────────────────────►   │                        │
     │                     │                         │                        │
     │  4. 输入 wsy1 / TempPass123!                   │                        │
     │ ──────────────────────────────────────────►   │                        │
     │                     │                         │                        │
     │  5. 验证成功，返回 code                         │                        │
     │ ◄──────────────────────────────────────────   │                        │
     │     重定向到 /callback?code=xxx                 │                        │
     │                     │                         │                        │
     │  6. 携带 code 访问 /callback                   │                        │
     │ ─────────────────► │                         │                        │
     │                     │                         │                        │
     │                     │  7. 用 code 换 token     │                        │
     │                     │ ─────────────────────►  │                        │
     │                     │                         │                        │
     │                     │  8. 返回 JWT token       │                        │
     │                     │ ◄─────────────────────  │                        │
     │                     │                         │                        │
     │                     │  9. 解析 token 得到 username=wsy1                 │
     │                     │     查表: wsy1 → 1.png                            │
     │                     │                         │                        │
     │                     │  10. 生成 S3 预签名 URL (aws s3 presign)           │  
     │                     │ ──────────────────────────────────────────────►  │
     │                     │                         │                        │
     │                     │  11. 返回预签名 URL                                │
     │                     │ ◄──────────────────────────────────────────────  │
     │                     │                         │                        │
     │  12. 返回 HTML       │                         │                        │
     │      (含预签名URL)   │                          │                        │
     │ ◄─────────────────  │                         │                        │
     │                     │                         │                        │
     │  13. 浏览器用预签名 URL 请求图片                  │                        │
     │ ────────────────────────────────────────────────────────────────────►  │ 
     │                     │                         │                        │
     │  14. 返回 1.png 图片内容                        │                        │
     │ ◄────────────────────────────────────────────────────────────────────  │
     │                     │                         │                        │
     ▼                     ▼                         ▼                        ▼

# 安全机制:                                                                               
  • 预签名 URL 1小时后过期                                                                 
  • 每次登录生成新的签名 URL                                                               
  • S3 桶非公开，无签名无法访问                                                            
  • 必须通过 Cognito 认证才能获取预签名 URL 
